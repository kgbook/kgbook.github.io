---
layout: post
title: C++ far over C
date: 2018-08-08
tags: [二维码识别]
---
## zbar 交叉编译 ##
### 编译 libiconv ###
```shell
curl -O http://mirror.hust.edu.cn/gnu/libiconv/libiconv-1.15.tar.gz
#wget http://mirror.hust.edu.cn/gnu/libiconv/libiconv-1.15.tar.gz

./configure --prefix=$HOME/tools/libiconv --host=arm-hisiv500-linux
```

### 编译 zbar ###
```shell
./configure --prefix=$HOME/tools/libzbar --host=arm-hisiv500-linux --without-x --without-python --without-imagemagick --without-gtk --without-qt --enable-video=no --enable-pthread=no

make && make install
```
没有生成Makefile，提示缺失 Makefile.in。
```
AM_INIT_AUTOMAKE([1.10 -Wall -Werror foreign subdir-objects std-options dist-bzip2]) 
```
在 configure.ac 中找到该语句，去除`-Werror`,重新配置生成 configure 文件，Makefile 仍未生成。

config.log 报错：
```shell
kgbook@tupu-linux:~/packages/ZBar-0.10$ automake --add-missing
configure.ac:10: error: required file 'config/ltmain.sh' not found
```
执行命令`libtoolize`，生成相应文件。
```shell
kgbook@tupu-linux:~/packages/ZBar-0.10$ libtoolize
libtoolize: putting auxiliary files in AC_CONFIG_AUX_DIR, 'config'.
libtoolize: linking file 'config/ltmain.sh'
libtoolize: putting macros in AC_CONFIG_MACRO_DIRS, 'config'.
libtoolize: linking file 'config/libtool.m4'
libtoolize: linking file 'config/ltoptions.m4'
libtoolize: linking file 'config/ltsugar.m4'
libtoolize: linking file 'config/ltversion.m4'
libtoolize: linking file 'config/lt~obsolete.m4'
```
重新`automake --add-missing`，生成 Makefile.in 文件。
```shell
kgbook@tupu-linux:~/packages/ZBar-0.10$ ls Makefile.*
Makefile.am  Makefile.in
```
配置 configure 选项， 生成 Makefile。

配置信息如下:
```shell
please verify that the detected configuration matches your expectations:
------------------------------------------------------------------------
X                 --with-x=disabled
pthreads          --enable-pthread=no
v4l               --enable-video=no
        => zbarcam video scanner will *NOT* be built
jpeg              --with-jpeg=no
        => JPEG image conversions will *NOT* be supported
Magick++          --with-imagemagick=no
        => the zbarimg file scanner will *NOT* be built
Python            --with-python=no
GTK+              --with-gtk=no
        => the GTK+ widget will *NOT* be built
Qt4               --with-qt=no
        => the Qt4 widget will *NOT* be built
```

Makefile 生成流程，参考下图。
<!---
![Makefile 生成流程图](https://wx4.sinaimg.cn/mw690/006VpBMWly1fu2cm0plxcj30dj08an09.jpg)
-->
<p align="center">
  <img width="487" height="298" src="https://wx4.sinaimg.cn/mw690/006VpBMWly1fu2cm0plxcj30dj08an09.jpg">
</p>

### 多国语言支持 ###
Makefile 依赖项，增改如下：
```makefile
DEFAULT_INCLUDES = -I. -I$(top_builddir)/includ -I${HOME}/tools/libiconv/include

LTLIBICONV = -L${HOME}/tools/libiconv/lib -liconv
```

如果没有 `make clean`， 而重新配置 configure 并 `make && make install`， 会有 1 warning:
```shell
libtool: warning: remember to run 'libtool --finish /home/kgbook/toos/libzbar/lib'
```

该警告只是提示`make`时的`--prefix`安装路径在执行`make install`时发生改变，没有影响，不用理会。

## 参考文献 ##
- [Error: ‘required file `./ltmain.sh' not found’](https://www.gnu.org/software/automake/manual/html_node/Error-required-file-ltmain_002esh-not-found.html)
- [Compiling zbar for leanXcam](https://github.com/scs/leanXcam/wiki/Compiling-zbar-for-leanXcam)
- [autoreconf --install failed](https://sourceforge.net/p/zbar/discussion/664596/thread/f4b52988/)
- [zbar.rb](https://github.com/Homebrew/homebrew-core/blob/master/Formula/zbar.rb)
- ["libtool: warning: remember to run 'libtool --finish /usr/lib64'" while compiling](https://www.linuxquestions.org/questions/slackware-14/libtool-warning-remember-to-run-%27libtool-finish-usr-lib64%27-while-compiling-slackbuilds-4175593774/)