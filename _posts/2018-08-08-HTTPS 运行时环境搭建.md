 ---
layout: post
title: HTTPS 运行时环境搭建
date: 2018-08-08
tags: [HTTPS]
---
### 问题

1. Could not resolve host
  - 创建`/etc/resolv.confg`，配置DNS；
  - 配置route table。

2. libcurl 处理 HTTPS 请求时, 报运行时错误：cert already in hash table。
```shell
error:0B07C065:x509 certificate routines:X509_STORE_add_cert:cert already in hash table
```

linux 查找并删除重复文件
```shell
cd /etc/ssl/certs
find . -maxdepth 1 -type f -print0 | xargs -0 md5sum | sort > /tmp/allfiles
cat /tmp/allfiles | uniq -w 32 > /tmp/uniqfiles
comm /tmp/allfiles /tmp/uniqfiles -2 -3 | cut -c 35- | tr '\n' '\0' | xargs -0 rm 
```

3. SSL certificate problem: certificate is not yet valid

系统时间为1970年时间，date或ntpdate更新时间。

4. Failed writing body (512 != 1563)

write回调函数返回数值有问题。

5. undefined reference to OPENSSL_init_crypto

> OPENSSL_init_crypto is a symbol that was introduced in OpenSSL 1.1.0 - but you are using OpenSSL 1.0.1u which predates that. You would need to use a more up to date version of OpenSSL.

### 参考资料
1. [用 uniq 除去重复行](https://www.ibm.com/developerworks/cn/linux/l-tip-prompt/l-tiptex6/index.html)
2. [linux shell， 三行命令：查找并删除重复的文件](https://blog.csdn.net/qingsong3333/article/details/77601071)
3. [SSL certificate problem: certificate is not yet valid](https://forums.developer.amazon.com/questions/81911/ssl-certificate-problem-certificate-is-not-yet-val.html)
4. [Failed writing body in libcurl](https://stackoverflow.com/questions/9311782/failed-writing-body-in-libcurl)
5. [undefined reference to OPENSSL_init_crypto](https://github.com/openssl/openssl/issues/6832)